<query-editor-row ctrl="ctrl">
	<li class="tight-form-item query-keyword" style="width: 75px">
		Query
	</li>
	<li>
    <div class="pull-right dropdown" style="margin-right: 10px;">
      <button class="btn btn-inverse dropdown-toggle" data-toggle="dropdown" bs-tooltip="'Query'">
        <i class="fa fa-database"></i>&nbsp;
        {{ctrl.target.query}} &nbsp; <span class="caret"></span>
      </button>

      <ul class="dropdown-menu" role="menu">
        <li ng-repeat="target in ctrl.panelCtrl.dashboard.targets" role="menuitem">
          <a ng-click="ctrl.setDataQuery(target.query);">{{target.query}}</a>
        </li>
      </ul>
    </div>
		<!--<input type="text" class="tight-form-input" style="width: 345px;" ng-model="ctrl.target.query" spellcheck='false' placeholder="Lucene query" ng-blur="ctrl.refresh()">-->
	</li>
	<li class="tight-form-item query-keyword">
		Alias
	</li>
	<li>
		<input type="text" class="tight-form-input" style="width: 200px;" ng-model="ctrl.target.alias" spellcheck='false' placeholder="alias patterns (empty = auto)" ng-blur="ctrl.refresh()">
	</li>
  <li class="tight-form-item query-keyword">
    DSL
  </li>
  <li>
    <input type="text" class="tight-form-input" style="width: 200px;" ng-model="ctrl.target.dslQuery" spellcheck='false' placeholder="Copy & Paste!" ng-blur="ctrl.refresh()">
  </li>
</query-editor-row>

<div ng-repeat="agg in ctrl.target.metrics">
	<elastic-metric-agg
		target="ctrl.target" index="$index"
		get-fields="ctrl.getFields($fieldType)"
		on-change="ctrl.queryUpdated()"
		es-version="ctrl.esVersion">
	</elastic-metric-agg>
</div>

<div ng-repeat="agg in ctrl.target.bucketAggs">
	<elastic-bucket-agg
		target="ctrl.target" index="$index"
		get-fields="ctrl.getFields($fieldType)"
		on-change="ctrl.queryUpdated()">
	</elastic-bucket-agg>
</div>

